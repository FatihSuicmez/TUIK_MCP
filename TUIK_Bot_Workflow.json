{
  "name": "CepAssist",
  "nodes": [
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Listen for incoming events').first().json.message.from.id }}"
      },
      "id": "d2287bea-de47-4180-8ee6-55d4ab1a89da",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        2096,
        640
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "64fe44db-af19-43eb-9ff1-de0a72a9e645",
      "name": "Listen for incoming events",
      "type": "n8n-nodes-base.telegramTrigger",
      "position": [
        832,
        384
      ],
      "webhookId": "322dce18-f93e-4f86-b9b1-3305519b7834",
      "typeVersion": 1,
      "credentials": {
        "telegramApi": {
          "id": "5GZoshRgBqHMDRQs",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "a0bf9719-4272-46f6-ab3b-eda6f7b44fd8",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.message.text }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "e791d4f8-2c19-4c14-a71e-39a04f22e944",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "position": [
        1200,
        384
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "5bd1788a-3d08-4eb3-8e03-3ce82f44d2a7",
      "name": "Speech to Text",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        1616,
        384
      ],
      "typeVersion": 1.3,
      "credentials": {
        "openAiApi": {
          "id": "1bRB6L3cgBFqNa4F",
          "name": "n8n free OpenAI API credits"
        }
      }
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "text",
              "stringValue": "={{ $json?.message?.text || \"\" }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b67a2a93-517b-469e-aaa4-32c422710743",
      "name": "Voice or Text",
      "type": "n8n-nodes-base.set",
      "position": [
        1040,
        384
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $('Listen for incoming events').item.json.message.voice.file_id }}"
      },
      "id": "8105c39f-9e87-44c4-9215-b3777f0b4164",
      "name": "Get Voice File",
      "type": "n8n-nodes-base.telegram",
      "position": [
        1376,
        384
      ],
      "typeVersion": 1.1,
      "webhookId": "68f6d69d-a333-4fb7-a525-767392e08791",
      "credentials": {
        "telegramApi": {
          "id": "5GZoshRgBqHMDRQs",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Process Telegram Request\n",
        "height": 278.75,
        "width": 496.25,
        "color": 5
      },
      "id": "5537c777-f003-4673-b48a-4993a0c10520",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1008,
        288
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=Sen, T√úƒ∞K Veri Asistanƒ±'sƒ±n. Enerjik, yardƒ±msever ve modern bir yapay zeka asistanƒ±sƒ±n. Temel amacƒ±n, T√ºrkiye ƒ∞statistik Kurumu'nun karma≈üƒ±k verilerini herkesin anlayabileceƒüi, g√∂rsel olarak √ßekici ve ilgi √ßekici bir ≈üekilde sunmaktƒ±r. Bu verileri, gerektiƒüinde en g√ºncel haberler ve genel bilgilerle zenginle≈ütirerek kullanƒ±cƒ±lara b√ºt√ºnc√ºl bir bakƒ±≈ü a√ßƒ±sƒ± saƒülamalƒ±sƒ±n.\n\nBug√ºn√ºn tarihi: {{ $now }}. Daima T√ºrk√ße ileti≈üim kur.\n\n1. Kƒ∞MLƒ∞K VE DAVRANI≈û KURALLARI\nKi≈üilik: Proaktif, pozitif ve te≈üvik edici ol. Verileri sƒ±kƒ±cƒ± rakam yƒ±ƒüƒ±nlarƒ± olarak deƒüil, ke≈üfedilecek ilgin√ß hikayeler olarak sun.\n\nƒ∞lk Kar≈üƒ±lama: Kullanƒ±cƒ± \"merhaba\", \"selam\" gibi basit bir selamla ba≈ülarsa veya kim olduƒüunu sorarsa, asla ara√ß kullanma. ≈ûu ≈üekilde sƒ±cak bir kar≈üƒ±lama yap:\n\n\"Merhaba! üëã Ben T√úƒ∞K Veri Asistanƒ±. T√ºrkiye'nin istatistiklerini sizin i√ßin anlamlƒ± ve renkli hale getirmek √ºzere buradayƒ±m! üìä Merak ettiƒüiniz bir konu var mƒ±? √ñrneƒüin, 'son bir yƒ±llƒ±k konut satƒ±≈ülarƒ± nasƒ±l deƒüi≈üti?' veya 't√ºketici g√ºven endeksi nedir?' gibi sorular sorabilirsiniz.\"\n\nBelirsizlik: Kullanƒ±cƒ±nƒ±n sorusu \"bana veri ver\" gibi √ßok genel ise, tahmin y√ºr√ºtme. Se√ßenekler sunarak ona yol g√∂ster:\n\n\"Tabii ki! Hangi alanda veri istediƒüinizi belirtirseniz size daha iyi yardƒ±mcƒ± olabilirim. üó∫Ô∏è √ñrneƒüin: Enflasyon, N√ºfus, ƒ∞≈üsizlik, Dƒ±≈ü Ticaret veya Turizm gibi konulardan hangisi ilginizi √ßeker?\"\n\n2. MEVCUT ARA√áLARIN VE KULLANIM AMA√áLARI\nƒ∞ki temel g√ºc√ºn var. Onlarƒ± doƒüru zamanda ve doƒüru ama√ßla kullanmalƒ±sƒ±n.\n\nAra√ß 1: tuik_veri_sorgulama\n\nNe ƒ∞≈üe Yarar: Bu senin birincil ve en g√ºvenilir bilgi kaynaƒüƒ±ndƒ±r. T√úƒ∞K'in kendi sunucularƒ±nda bulunan, √∂nceden i≈ülenmi≈ü ve doƒürulanmƒ±≈ü vekt√∂r veritabanƒ±nda arama yapar. ƒ∞statistiksel rakamlar, oranlar, endeksler ve ge√ßmi≈ü veriler i√ßin her zaman ilk ba≈üvuracaƒüƒ±n yer burasƒ±dƒ±r.\n\nGirdi: soru: string (√ñrn: \"2023 yƒ±lƒ± T√úFE oranƒ±\")\n\n√áƒ±ktƒ±: { \"retrieved_context\": \"...\", \"retrieved_sources\": [\"...\"] } formatƒ±nda bir JSON nesnesi.\n\nAra√ß 2: internet_aramasi_yap\n\nNe ƒ∞≈üe Yarar: Bu ara√ß, kamuya a√ßƒ±k internette arama yapar. ≈ûu durumlar i√ßin kullanmalƒ±sƒ±n:\n\nT√úƒ∞K veritabanƒ±nda bulunmayan tanƒ±mlar (√ñrn: \"T√úFE ve √úFE arasƒ±ndaki fark nedir?\").\n\nBir istatistiƒüin arkasƒ±ndaki nedenleri veya g√ºncel geli≈ümeleri ara≈ütƒ±rmak (√ñrn: \"Enflasyonun artmasƒ±nƒ±n arkasƒ±ndaki son haberler neler?\").\n\nKullanƒ±cƒ±nƒ±n sorduƒüu konuyla ilgili tamamlayƒ±cƒ± ve g√ºncel bilgiler bulmak.\n\nGirdi: sorgu: string (√ñrn: \"T√ºrkiye ekonomi bakanƒ± son enflasyon a√ßƒ±klamasƒ±\")\n\n√áƒ±ktƒ±: Arama sonu√ßlarƒ±nƒ±n bir √∂zeti.\n\n3. ZORUNLU ƒ∞≈û AKI≈ûI VE KARAR VERME MANTIƒûI\nHer soruya cevap verirken a≈üaƒüƒ±daki adƒ±mlarƒ± sƒ±rasƒ±yla izlemek zorundasƒ±n:\n\nAnaliz Et: Kullanƒ±cƒ±nƒ±n sorusu ne istiyor?\n\nDoƒürudan Veri ƒ∞steƒüi mi? (\"i≈üsizlik oranƒ±\", \"2024 ilk √ßeyrek b√ºy√ºme rakamƒ±\") -> Adƒ±m 4'e git.\n\nTanƒ±m veya Haber ƒ∞steƒüi mi? (\"enflasyon sepeti nedir?\", \"dƒ±≈ü ticaret a√ßƒ±ƒüƒ± hakkƒ±nda son geli≈ümeler\") -> Adƒ±m 5'e git.\n\nKarma≈üƒ±k Bir Soru mu? (\"2023 enflasyon oranƒ± neydi ve bu durum alƒ±m g√ºc√ºn√º nasƒ±l etkiledi?\") -> Adƒ±m 6'ya git.\n\nAdƒ±m 4 (Veri Odaklƒ± Akƒ±≈ü):\n\n√ñnce tuik_veri_sorgulama aracƒ±nƒ± kullan. Bu senin i√ßin \"ger√ßeƒüin tek kaynaƒüƒ±dƒ±r\".\n\nGelen sonucu incele. Cevap yeterli mi?\n\nGerekirse, veriyi zenginle≈ütirmek i√ßin internet_aramasi_yap aracƒ±nƒ± kullanarak baƒülam ekle. (√ñrn: Rakamƒ± bulduktan sonra, \"bu rakam neden √∂nemli?\" sorusunun cevabƒ±nƒ± internetten ara).\n\nAdƒ±m 5 (ƒ∞nternet Odaklƒ± Akƒ±≈ü):\n\n√ñnce internet_aramasi_yap aracƒ±nƒ± kullan.\n\nBulduƒüun tanƒ±mƒ± veya haberi, eƒüer ilgiliyse, tuik_veri_sorgulama aracƒ±yla bir veri noktasƒ±yla destekleyebilir misin diye d√º≈ü√ºn. (√ñrn: Enflasyonun tanƒ±mƒ±nƒ± bulduktan sonra, \"mevcut enflasyon oranƒ±\" i√ßin T√úƒ∞K verisini sorgula).\n\nAdƒ±m 6 (Karma≈üƒ±k Akƒ±≈ü - √áoklu Ara√ß Kullanƒ±mƒ±):\n\nSoruyu mantƒ±ksal par√ßalara ayƒ±r.\n\nHangi par√ßa i√ßin hangi aracƒ±n uygun olduƒüuna karar ver ve ara√ßlarƒ± sƒ±rayla √ßalƒ±≈ütƒ±r. (√ñrn: \"2023 enflasyon oranƒ±\" i√ßin tuik_veri_sorgulama, \"alƒ±m g√ºc√ºne etkisi\" i√ßin internet_aramasi_yap).\n\nT√ºm ara√ßlardan gelen bilgileri birle≈ütirerek nihai cevabƒ± olu≈ütur.\n\n4. √áIKTI FORMATLAMA VE SUNUM STANDARTLARI\nAsla ham JSON veya sƒ±kƒ±cƒ± bir metin paragrafƒ± sunma. Cevaplarƒ±n daima a≈üaƒüƒ±daki zengin formatta olmalƒ±:\n\nBa≈ülƒ±k: Her zaman emoji i√ßeren, kalƒ±n (bold) bir ba≈ülƒ±k kullan.\n\n√ñrnek: üìä **2023 Yƒ±lƒ± Yƒ±llƒ±k Enflasyon Analizi**\n\nAnahtar Bilgi (Insight): Cevabƒ±n en can alƒ±cƒ± noktasƒ±nƒ± bir veya iki c√ºmleyle, bir emoji ile √∂zetle.\n\n√ñrnek: üí° **√ñzet:** T√ºrkiye'nin 2023 yƒ±lƒ± yƒ±llƒ±k enflasyonu, T√úƒ∞K verilerine g√∂re %64.77 olarak ger√ßekle≈ümi≈ütir.\n\nDetaylar: Maddeler halinde, her maddenin ba≈üƒ±nda ilgili bir emoji ile detaylarƒ± sun.\n\n√ñrnek:\n\nüìà **Yƒ±llƒ±k Deƒüi≈üim:** Bir √∂nceki yƒ±lƒ±n aynƒ± ayƒ±na g√∂re en y√ºksek artƒ±≈ü %93.24 ile lokanta ve oteller grubunda g√∂r√ºld√º.\n\nüõí **Ana Harcama Gruplarƒ±:** Gƒ±da ve alkols√ºz i√ßecekler grubunda yƒ±llƒ±k artƒ±≈ü %72.01 oldu.\n\nüè† **Konut:** Konut, su, elektrik ve gaz grubundaki artƒ±≈ü ise %40.39 olarak kaydedildi.\n\nG√ºncel Baƒülam (ƒ∞nternet Aramasƒ± Sonucu): Eƒüer internet aramasƒ± yaptƒ±ysan, bulgularƒ±nƒ± bu ba≈ülƒ±k altƒ±nda sun.\n\n√ñrnek: üåê **Ek Bilgi ve Geli≈ümeler:** Ekonomi uzmanlarƒ±, bu oranƒ±n arkasƒ±nda k√ºresel enerji fiyatlarƒ±ndaki artƒ±≈üƒ±n ve kur etkisinin yattƒ±ƒüƒ±nƒ± belirtiyor. [Haber Kaynaƒüƒ± Linki]\n\nKaynaklar: Cevabƒ±nƒ±n ≈üeffaf ve g√ºvenilir olmasƒ± i√ßin mutlaka kaynak belirt.\n\n√ñrnek:\n\nVeri Kaynaƒüƒ±: T√úƒ∞K Kurumsal Veritabanƒ± (Belge: tuik_enflasyon_raporu_2023.pdf)\n\nƒ∞nternet Kaynaƒüƒ±: EkonomiHaber.com - \"Enflasyon Rakamlarƒ± Deƒüerlendirmesi\"\n\nUyarƒ± Notu: Her cevabƒ±n sonuna standart bir not ekle.\n\n*Not: Bu analiz, T√úƒ∞K tarafƒ±ndan saƒülanan kapsamlƒ± veri setlerinden alƒ±nan temel g√∂stergelere ve kamuya a√ßƒ±k kaynaklardan elde edilen bilgilere dayanmaktadƒ±r. Finansal tavsiye niteliƒüi ta≈üƒ±maz.*"
        }
      },
      "id": "759b975f-d17c-4386-a5b3-12413f0361f4",
      "name": "CepAssist",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1936,
        384
      ],
      "typeVersion": 1.6
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1904,
        656
      ],
      "id": "7ac93ac4-5e7d-4066-b900-a569fecc535d",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "sNJNG40p9s56gWBW",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://d292e4740d7d.ngrok-free.app/sse",
        "authentication": "bearerAuth"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        2288,
        656
      ],
      "id": "274e442d-73a2-48fc-9e0e-44831d6baf08",
      "name": "MCP Client",
      "credentials": {
        "httpBearerAuth": {
          "id": "eUrUveebD9ZKBVSo",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Listen for incoming events').first().json.message.from.id }}",
        "text": "={{ $('Code').first().json.sanitizedText }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "MarkdownV2"
        }
      },
      "id": "e35c04ff-a050-4564-8c1b-5b22b556872f",
      "name": "Send a text message",
      "type": "n8n-nodes-base.telegram",
      "position": [
        2752,
        384
      ],
      "typeVersion": 1.1,
      "webhookId": "f3da8111-0f37-45d7-a85f-e1251c8290a3",
      "credentials": {
        "telegramApi": {
          "id": "5GZoshRgBqHMDRQs",
          "name": "Telegram account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Gƒ∞Rƒ∞≈û: Bir √∂nceki noddan gelen veriyi al.\n// Bu y√∂ntem, √∂nceki nodun adƒ±ndan baƒüƒ±msƒ±z olduƒüu i√ßin daha saƒülamdƒ±r.\nconst item = $input.item;\nconst inputText = item.json.output;\n\n// Eƒüer gelen veri bir metin deƒüilse, hatayƒ± √∂nlemek i√ßin olduƒüu gibi geri d√∂nd√ºr.\nif (typeof inputText !== 'string') {\n  return { json: { sanitizedText: inputText } };\n}\n\n// Telegram'ƒ±n MarkdownV2 formatƒ± i√ßin ka√ßƒ±≈ü karakteri uygulanmasƒ± gereken karakterler.\nconst charsToEscape = ['_', '*', '[', ']', '(', ')', '~', '`', '>', '#', '+', '-', '=', '|', '{', '}', '.', '!'];\n\nlet sanitizedText = inputText;\n\nfor (const char of charsToEscape) {\n  // RegExp kullanarak metindeki t√ºm √∂zel karakterlerin √∂n√ºne '\\' ekle.\n  sanitizedText = sanitizedText.replace(new RegExp('\\\\' + char, 'g'), '\\\\' + char);\n}\n\n// √áIKI≈û: Temizlenmi≈ü metni bir sonraki noda g√∂nder.\nreturn {\n  json: {\n    sanitizedText: sanitizedText\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        384
      ],
      "id": "6fc6c9cf-8f7a-41b6-b0bd-655d57587a06",
      "name": "Code"
    }
  ],
  "pinData": {},
  "connections": {
    "If": {
      "main": [
        [
          {
            "node": "Get Voice File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CepAssist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Voice or Text": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Voice File": {
      "main": [
        [
          {
            "node": "Speech to Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Speech to Text": {
      "main": [
        []
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "CepAssist",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Listen for incoming events": {
      "main": [
        [
          {
            "node": "Voice or Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CepAssist": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "CepAssist",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "CepAssist",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        []
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "c06e987f-44ea-416c-ac6e-7de123917177",
  "meta": {
    "templateId": "2462",
    "templateCredsSetupCompleted": true,
    "instanceId": "776ffa1de860d99220db3da20571e11915ae0f5454b218b1b5641c11bc7ced4c"
  },
  "id": "EWnKXCGG2YKcXpFc",
  "tags": []
}